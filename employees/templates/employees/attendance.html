{% extends "main/base.html" %}
{% load crispy_forms_filters %}
{% load static %}
{% block modal-body %}
    <img id="qr" src="#" alt="" class="mx-auto d-block">
{% endblock modal-body %}
{% block modal-footer %}
    <button type="submit" class="btn btn-primary" id="done" form="qrCode" data-dismiss="modal">Done</button>
{% endblock modal-footer %}
{% block content %}
    <script src="{% static 'JS/form_preloader.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
    <script src="{% static 'JS/signature_utilities.js' %}"></script>
    <script src="{% static 'JS/attendance_utilities.js' %}"></script>
    <div data-src="{% static 'JS/jquery.classyqr.js' %}" id="qr_script"></div>
    <h1 class="mt-3">{{ employee.get_full_name }}</h1>
    <h3>{% if request.resolver_match.url_name == 'employee-assign-attendance' %}Assign{% else %}Edit{% endif %} Attendance Point</h3>
    <div class="row mt-3">
        <div class="col">
            <form method="POST" role="form" action="{% if request.resolver_match.url_name == 'employee-assign-attendance' %}{% url 'employee-assign-attendance' employee.employee_id %}{% else %}{% url 'employee-edit-attendance' attendance.id %}{% endif %}" data-manager-required="{% if request.resolver_match.url_name == 'employee-assign-attendance' %}true{% else %}false{% endif %}" data-other-required="false" data-signature-method="In Person">
                {% csrf_token %}
                <div class="form-row justify-content-start">
                    <div class="form-group col-sm-4 col-12">
                        {{ form.incident_date|as_crispy_field }}
                    </div>
                    <div class="form-group col-sm-4 col-12">
                        {{ form.reason|as_crispy_field }}
                    </div>
                    <div class="form-group col-sm-4 col-12">
                        {{ form.exemption|as_crispy_field }}
                    </div>
                </div>
                <div class="form-row" style="display: none" id="comments_container">
                    <div class="form-group col-12">
                        {{ form.comments|as_crispy_field }}
                    </div>
                </div>
                {% if request.resolver_match.url_name == 'employee-assign-attendance' %}
                    <div class="form-row">
                        <input type="hidden" value="{% if signature_method %}{{ signature_method }}{% else %}In Person{% endif %}" name="signature_method" id="signature_method">
                        <div class="form-group col-lg-6 col-12 pr-lg-3" id="other_container">
                            <div class="row justify-content-between">
                                <div class="col-4">
                                    <p id="other_signature_title">Employee Signature</p>
                                </div>
                                <div class="col-8 text-right">
                                    <button class="btn btn-secondary btn-sm canvas-qr" type="button" data-canvas-type="other" data-qr-url="https://{{ domain }}{% url 'employee-sign-document' signature_method='QR' record_id=employee.employee_id %}" data-signature-url="{% url 'employee-get-signature' employee.employee_id %}" data-clear-url="{% url 'employee-clear-signature' employee.employee_id %}" id="other_qr">Get QR</button>
                                    <button class="btn btn-secondary btn-sm canvas-clear" type="button" data-canvas-type="other">Clear</button>
                                    <button class="btn btn-secondary btn-sm canvas-undo" type="button" data-canvas-type="other">Undo</button>
                                </div>
                            </div>
                            <canvas class="border border-dark" id="other_canvas"></canvas>
                        </div>
                        <div class="form-group col-lg-6 col-12 pl-lg-3" id="manager_container">
                            <div class="row justify-content-between">
                                <div class="col-4">
                                    <p>Manager Signature*</p>
                                </div>
                                <div class="col-8 text-right">
                                    <button class="btn btn-secondary btn-sm canvas-qr" type="button" data-canvas-type="manager" data-qr-url="https://{{ domain }}{% url 'employee-sign-document' signature_method='QR' record_id=request.user.employee_id %}" data-signature-url="{% url 'employee-get-signature' %}" id="manager_qr">Get QR</button>
                                    <button class="btn btn-secondary btn-sm canvas-load" type="button" data-canvas-type="manager" data-signature-url="{% url 'employee-get-signature' request.user.employee_id %}">Load Last</button>
                                    <button class="btn btn-secondary btn-sm canvas-clear" type="button" data-canvas-type="manager">Clear</button>
                                    <button class="btn btn-secondary btn-sm canvas-undo" type="button" data-canvas-type="manager">Undo</button>
                                </div>
                            </div>
                            <canvas class="border border-dark" id="manager_canvas"></canvas>
                        </div>
                    </div>
                    {{ form.refused_to_sign|as_crispy_field }}
                {% endif %}
                <div class="form-row mb-3">
                    <a href="{% url 'employee-account' employee.employee_id %}" class="account-content mr-2">
                        <div class="btn btn-secondary">
                            Cancel
                        </div>
                    </a>
                    {% if request.resolver_match.url_name == 'employee-assign-attendance' %}
                        <button class="btn btn-secondary mr-2" type="button" id="comments_btn">Employee Comments</button>
                    {% endif %}
                    <button class="btn btn-primary" type="button" value="Submit" id="submit_button">{% if request.resolver_match.url_name == 'employee-assign-attendance' %}Assign{% else %}Save{% endif %}</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}